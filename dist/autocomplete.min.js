"use strict";angular.module("google.places",[]).factory("googlePlacesApi",["$window",function(a){if(!a.google)throw"Global `google` var missing. Did you forget to include the places API script?";return a.google}]).directive("gPlacesAutocomplete",["$parse","$compile","$timeout","$document","googlePlacesApi",function(a,b,c,d,e){return{restrict:"A",require:"^ngModel",scope:{model:"=ngModel",placeDetail:"=?",latModel:"=?",lngModel:"=?",minLength:"=?",tooltipContent:"=?",options:"=?",forceSelection:"=?",customPlaces:"=?",newOffer:"=?",callback:"&?"},controller:["$scope",function(a){}],link:function(a,f,g,h){function i(){f.bind("keyup",l),f.bind("blur",p),f.bind("submit",p),f.bind("focus",o),a.$watch("selected",q)}function j(){var c,e=angular.element("<div g-places-autocomplete-drawer></div>"),f=angular.element(d[0].body);e.attr({input:"input",query:"query",predictions:"predictions",active:"active",selected:"selected","min-length":"minLength","tooltip-content":"tooltipContent","component-focused":"componentFocused"}),c=b(e)(a),f.append(c)}function k(){h.$parsers.push(r),h.$formatters.push(t),h.$render=u}function l(b){a.getPredictionsEnabled=!0,0!==a.predictions.length&&-1!==A(F,b.which)&&(b.preventDefault(),b.which===E.down?(a.active=(a.active+1)%a.predictions.length,a.$digest()):b.which===E.up?(a.active=(a.active?a.active:a.predictions.length)-1,a.$digest()):13===b.which||9===b.which?(a.forceSelection&&(a.active=-1===a.active?0:a.active),a.$apply(function(){a.selected=a.active,-1===a.selected&&v()})):27===b.which&&a.$apply(function(){b.stopPropagation(),v()}))}function m(b){a.placeDetail=a.placeDetail||{},a.placeDetail.isValid=!1,a.newOffer?(a.placeDetail.isValid=!0,a.placeDetail.address=b.formatted_address,a.placeDetail.latitude=b.geometry.location.lat(),a.placeDetail.longitude=b.geometry.location.lng(),a.placeDetail.geohash=geohash.hash(a.placeDetail.latitude,a.placeDetail.longitude)):a.placeDetail=b,h.$setViewValue(f.val()),n()}function n(){a.callback&&a.callback()}function o(){a.componentFocused=!0}function p(b){a.componentFocused=!1,0!==a.predictions.length&&(a.forceSelection&&(a.selected=-1===a.selected?0:a.selected),a.$digest(),a.$apply(function(){-1===a.selected&&v()}))}function q(){var b;b=a.predictions[a.selected],b&&(b.is_custom?a.$apply(function(){a.model=b.description,a.latModel=b.place.geometry.location.lat(),a.lngModel=b.place.geometry.location.lng(),m(b.place),a.$emit("g-places-autocomplete:select",b.place),c(function(){h.$viewChangeListeners.forEach(function(a){a()})})}):(c(function(){a.model=b.description}),H.getDetails({placeId:b.place_id},function(b,d){d==e.maps.places.PlacesServiceStatus.OK&&a.$apply(function(){a.latModel=b.geometry.location.lat(),a.lngModel=b.geometry.location.lng(),m(b),a.$emit("g-places-autocomplete:select",b),c(function(){h.$viewChangeListeners.forEach(function(a){a()})})})})),a.getPredictionsEnabled=!1,v())}function r(b){var c;return a.query=b,b&&y(b)?a.minLength>b.length?void v():(c=angular.extend({input:b},a.options),clearTimeout(D),D=setTimeout(function(){s(c)},700),a.forceSelection?h.$modelValue:b):b}function s(b){a.getPredictionsEnabled&&G.getPlacePredictions(b,function(b,c){a.$apply(function(){var d;v(),a.customPlaces&&(d=w(a.query),a.predictions.push.apply(a.predictions,d)),c==e.maps.places.PlacesServiceStatus.OK&&a.predictions.push.apply(a.predictions,b),a.predictions.length>5&&(a.predictions.length=5)})})}function t(a){var b="";return y(a)?b=a:z(a)&&(b=a.formatted_address),b}function u(){return f.val(h.$viewValue)}function v(){a.active=-1,a.selected=-1,a.predictions=[]}function w(b){var c,d,e,f=[];for(e=0;e<a.customPlaces.length;e++)c=a.customPlaces[e],d=x(b,c),d.matched_substrings.length>0&&f.push({is_custom:!0,custom_prediction_label:c.custom_prediction_label||"(Custom Non-Google Result)",description:c.formatted_address,place:c,matched_substrings:d.matched_substrings,terms:d.terms});return f}function x(a,b){var c,d,e,f=a+"",g=[],h=[];for(d=b.formatted_address.split(","),e=0;e<d.length;e++)c=d[e].trim(),f.length>0&&(c.length>=f.length?(B(c,f)&&h.push({length:f.length,offset:e}),f=""):B(f,c)?(h.push({length:c.length,offset:e}),f=f.replace(c,"").trim()):f=""),g.push({value:c,offset:b.formatted_address.indexOf(c)});return{matched_substrings:h,terms:g}}function y(a){return"[object String]"==Object.prototype.toString.call(a)}function z(a){return"[object Object]"==Object.prototype.toString.call(a)}function A(a,b){var c,d;if(null===a)return-1;for(d=a.length,c=0;d>c;c++)if(a[c]===b)return c;return-1}function B(a,b){return 0===C(a).lastIndexOf(C(b),0)}function C(a){return null===a?"":a.toLowerCase()}var D,E={tab:9,enter:13,esc:27,up:38,down:40},F=[E.tab,E.enter,E.esc,E.up,E.down],G=new e.maps.places.AutocompleteService,H=new e.maps.places.PlacesService(f[0]);!function(){a.query="",a.predictions=[],a.input=f,a.options=a.options||{},a.minLength=a.minLength||0,a.getPredictionsEnabled=!0,a.componentFocused=!1,f.attr("autocomplete","off"),j(),i(),k()}()}}}]).directive("gPlacesAutocompleteDrawer",["$window","$document",function(a,b){var c=['<div class="pac-container bottom" ng-if="isOpenTooltip()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: position.width+\'px\'}" style="display: block;">','<div class="arrow"></div>','<div class="pac-inner">','<div class="pac-content">{{tooltipContent}}</div>',"</div>","</div>",'<div class="pac-container bottom" ng-if="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: position.width+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">','<div class="arrow"></div>','<div class="pac-content">','  <div class="pac-item" g-places-autocomplete-prediction index="$index" prediction="prediction" query="query"','       ng-repeat="prediction in predictions track by $index" ng-class="{\'pac-item-selected\': isActive($index) }"','       ng-mouseenter="selectActive($index)" ng-click="selectPrediction($index)" role="option" id="{{prediction.id}}">',"  </div>","</div>","</div>","</div>"];return{restrict:"A",scope:{input:"=",query:"=",predictions:"=",active:"=",selected:"=",minLength:"=?",tooltipContent:"=?",componentFocused:"="},template:c.join(""),link:function(c,d){function e(c){var d=c[0],e=d.getBoundingClientRect(),f=b[0].documentElement,g=b[0].body,h=a.pageYOffset||f.scrollTop||g.scrollTop,i=a.pageXOffset||f.scrollLeft||g.scrollLeft;return{width:e.width,height:e.height,top:e.top+e.height+h,left:e.left+i}}d.bind("mousedown",function(a){a.preventDefault()}),a.onresize=function(){c.$apply(function(){c.position=e(c.input)})},c.isOpenTooltip=function(){return c.position=e(c.input),c.componentFocused&&c.tooltipContent&&c.query&&c.minLength>0&&c.query.length<c.minLength},c.isOpen=function(){return c.predictions.length>0},c.isActive=function(a){return c.active===a},c.selectActive=function(a){c.active=a},c.selectPrediction=function(a){c.selected=a},c.$watch("predictions",function(){c.position=e(c.input)},!0)}}}]).directive("gPlacesAutocompletePrediction",[function(){var a=['<span class="pac-icon pac-icon-marker"></span>','<span class="pac-item-query" ng-bind-html="prediction | highlightMatched"></span>','<span ng-repeat="term in prediction.terms | unmatchedTermsOnly:prediction">{{term.value | trailingComma:!$last}}&nbsp;</span>','<span class="custom-prediction-label" ng-if="prediction.is_custom">&nbsp;{{prediction.custom_prediction_label}}</span>'];return{restrict:"A",scope:{index:"=",prediction:"=",query:"="},template:a.join("")}}]).filter("highlightMatched",["$sce",function(a){return function(b){var c,d="",e="";return b.matched_substrings.length>0&&b.terms.length>0&&(c=b.matched_substrings[0],d=b.terms[0].value.substr(c.offset,c.length),e=b.terms[0].value.substr(c.offset+c.length)),a.trustAsHtml('<span class="pac-matched">'+d+"</span>"+e)}}]).filter("unmatchedTermsOnly",[function(){return function(a,b){var c,d,e=[];for(c=0;c<a.length;c++)d=a[c],b.matched_substrings.length>0&&d.offset>b.matched_substrings[0].length&&e.push(d);return e}}]).filter("trailingComma",[function(){return function(a,b){return b?a+",":a}}]);